<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${pageTitle}">Shop</title>

  <link rel="stylesheet" th:href="@{/css/header.css}">
  <link rel="stylesheet" th:href="@{/css/footer.css}">
  <link rel="stylesheet" th:href="@{/css/banner.css}">
  <link rel="stylesheet" th:href="@{/css/shop.css}">
  <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- =============== HEADER =============== -->
<div th:replace="fragments/_header :: header"></div>

<main>
  <!-- =============== CATEGORY FILTER =============== -->
  <section class="shop-category-filter">
    <div class="filter-header">
      <h2 class="filter-title">Shop By Category:</h2>

      <div class="category-buttons">
        <!-- N√∫t All -->
        <a th:href="@{'/shop'}"
           class="category-btn"
           th:classappend="${selectedCategory == null} ? 'active' : ''">All</a>

        <!-- Danh m·ª•c -->
        <a th:each="c : ${categories}"
           th:href="@{'/shop'(category=${c.name})}"
           th:text="${c.name}"
           class="category-btn"
           th:classappend="${selectedCategory == c.name} ? 'active' : ''"></a>

        <!-- N·∫øu DB r·ªóng -->
        <span th:if="${#lists.isEmpty(categories)}"
              style="color:#999;font-style:italic;">
          (Ch∆∞a c√≥ danh m·ª•c n√†o)
        </span>
      </div>
    </div>
  </section>

    </a>
  </div>
</section>

<!-- üîç K·∫æT QU·∫¢ T√åM KI·∫æM -->
<div class="search-result-header" th:if="${keyword != null and !noResult}">
  <h2>K·∫øt qu·∫£ t√¨m ki·∫øm cho: "<span th:text="${keyword}"></span>"</h2>
  <a th:href="@{/shop}" class="btn-reset-search">‚Üê Xem t·∫•t c·∫£ s·∫£n ph·∫©m</a>
</div>

<!-- ‚ö†Ô∏è TH√îNG B√ÅO KHI KH√îNG C√ì K·∫æT QU·∫¢ -->
<div class="no-result" th:if="${noResult}">
  <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p v·ªõi t·ª´ kh√≥a "<span th:text="${keyword}"></span>".</p>
  <a th:href="@{/shop}" class="btn-reset-search">‚Üê Quay l·∫°i xem to√†n b·ªô s·∫£n ph·∫©m</a>
</div>

<!-- =============== PRODUCT AREA =============== -->
<div class="shop-container">

  <!-- üß© SIDEBAR B√äN TR√ÅI -->
  <aside class="shop-sidebar">
    <!-- üíÑ Danh m·ª•c -->
<!-- üíÑ Danh m·ª•c -->
<div class="filter-group">
  <h4>Danh m·ª•c</h4>
  <ul>
    <li><a th:href="@{/shop}" th:classappend="${selectedCategory == null} ? 'active' : ''">T·∫•t c·∫£</a></li>

    <li th:each="c : ${categories}">
      <a th:href="@{'/shop'(category=${c.name})}"
         th:text="${c.name}"
         th:classappend="${selectedCategory == c.name} ? 'active' : ''"></a>
    </li>

    <li th:if="${#lists.isEmpty(categories)}" style="color:#999;font-style:italic;">(Ch∆∞a c√≥ danh m·ª•c n√†o)</li>
  </ul>
</div>


<!-- üé® Th∆∞∆°ng hi·ªáu -->
<div class="filter-group">
  <h4>Th∆∞∆°ng hi·ªáu</h4>
  <ul>
    <li><a th:href="@{/shop}" th:classappend="${selectedBrand == null} ? 'active' : ''">T·∫•t c·∫£</a></li>

    <li th:each="b : ${brands}">
      <a th:href="@{'/shop'(brand=${b.name})}"
         th:text="${b.name}"
         th:classappend="${selectedBrand == b.name} ? 'active' : ''"></a>
    </li>

    <!-- N·∫øu DB r·ªóng -->
    <li th:if="${#lists.isEmpty(brands)}" style="color:#999;font-style:italic;">(Ch∆∞a c√≥ th∆∞∆°ng hi·ªáu n√†o)</li>
  </ul>
</div>


    <!-- üí∞ Kho·∫£ng gi√° -->
    <div class="filter-group">
      <h4>Gi√°</h4>
      <ul>
        <li><a th:href="@{/shop(priceRange='low')}" th:classappend="${selectedPriceRange == 'low'} ? 'active' : ''">D∆∞·ªõi 200.000‚Ç´</a></li>
        <li><a th:href="@{/shop(priceRange='mid')}" th:classappend="${selectedPriceRange == 'mid'} ? 'active' : ''">200.000‚Ç´ ‚Äì 400.000‚Ç´</a></li>
        <li><a th:href="@{/shop(priceRange='high')}" th:classappend="${selectedPriceRange == 'high'} ? 'active' : ''">Tr√™n 400.000‚Ç´</a></li>
      </ul>
    </div>
  </aside>

  <!-- üñºÔ∏è SHOP BANNER (n·∫±m tr√™n ph·∫ßn s·∫Øp x·∫øp v√† s·∫£n ph·∫©m) -->
  <section class="shop-banner">
    <img th:src="@{/images/banner/shop-banner.jpeg?v=2}" alt="Shop Banner">
  </section>

  <!-- ‚úÖ S·∫ÆP X·∫æP THEO (ƒë∆∞a ra ngo√†i, ngay d∆∞·ªõi banner, cƒÉn gi·ªØa theo s·∫£n ph·∫©m) -->
  <section class="sort-section">
    <form th:action="@{/shop}" method="get" class="sort-form">
      <input type="hidden" name="category" th:value="${selectedCategory}">
      <label for="sortSelect">S·∫Øp x·∫øp theo:</label>
      <select id="sortSelect" name="sort" onchange="this.form.submit()">
        <option value="">-- Kh√¥ng s·∫Øp x·∫øp --</option>
        <option value="newest" th:selected="${sort == 'newest'}">M·ªõi nh·∫•t</option>
        <option value="bestseller" th:selected="${sort == 'bestseller'}">B√°n ch·∫°y nh·∫•t</option>
        <option value="priceAsc" th:selected="${sort == 'priceAsc'}">Gi√°: Th·∫•p ‚Üí Cao</option>
        <option value="priceDesc" th:selected="${sort == 'priceDesc'}">Gi√°: Cao ‚Üí Th·∫•p</option>
        <option value="nameAsc" th:selected="${sort == 'nameAsc'}">T√™n: A ‚Üí Z</option>
        <option value="nameDesc" th:selected="${sort == 'nameDesc'}">T√™n: Z ‚Üí A</option>
      </select>

      <!-- üîÅ N√∫t ƒë·∫∑t l·∫°i -->
      <a th:href="@{/shop(category=${selectedCategory})}" class="reset-sort-btn">üîÅ ƒê·∫∑t l·∫°i</a>
    </form>
  </section>

  <!-- üõç DANH S√ÅCH S·∫¢N PH·∫®M -->
  <section class="shop-products">
    <div th:unless="${#lists.isEmpty(products)}" class="product-grid">
      <div th:each="p : ${products}" class="product-card-adv">

        <!-- H√¨nh ·∫£nh -->
        <div class="product-img-wrapper">
          <a th:href="@{'/shop/product/' + ${p.productId}}">
            <img th:src="@{${p.imageUrl}}" th:alt="${p.name}">
          </a>

          <!-- Nh√£n ‚ÄúNew‚Äù -->
          <div class="product-labels">
            <span class="new"
                  th:if="${p.createdAt != null 
                      and T(java.time.temporal.ChronoUnit).DAYS.between(p.createdAt, T(java.time.LocalDateTime).now()) < 14}">
              New
            </span>
          </div>
        </div>

        <!-- T√™n -->
        <h3 class="product-name" th:text="${p.name}"></h3>

        <!-- Gi√° -->
        <div class="product-prices">
          <span class="price-range"
                th:if="${p.variants != null and !#lists.isEmpty(p.variants)}"
                th:text="${@productServiceImpl.getPriceRange(p)}"></span>
          <span class="price-placeholder"
                th:if="${p.variants == null or #lists.isEmpty(p.variants)}">
            Li√™n h·ªá ƒë·ªÉ xem gi√°
          </span>
        </div>

        <!-- ‚≠ê Rating -->
<div class="product-rating">
  <!-- Hi·ªÉn th·ªã sao -->
  <i class="fa-solid fa-star"
     th:each="i : ${#numbers.sequence(1, (p.rating != null ? p.rating.intValue() : 5))}"></i>

  <!-- Hi·ªÉn th·ªã s·ªë ƒëi·ªÉm trung b√¨nh -->
  <span th:if="${p.rating != null}" 
        th:text="'(' + ${#numbers.formatDecimal(p.rating, 1, 1)} + ')'"
        class="rating-value"></span>
</div>

      </div>
    </div>

    <!-- N·∫øu DB r·ªóng -->
    <div th:if="${#lists.isEmpty(products)}" class="no-products">
      <p>Hi·ªán ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong danh m·ª•c n√†y.</p>
    </div>
  </section>
</div>
</main>

<p th:if="${totalPages > 1}" 
   style="text-align:center; color:#b14d7d; margin-top:50px; font-weight:500;">
  Trang <span th:text="${currentPage}"></span> / <span th:text="${totalPages}"></span>
</p>


<!-- =============== PAGINATION =============== -->
<div class="pagination pastel-pagination" th:if="${totalPages >= 1}">
  <!-- N√∫t Tr∆∞·ªõc -->
  <a th:if="${currentPage > 1}"
     th:href="@{'/shop'(category=${selectedCategory}, brand=${selectedBrand}, priceRange=${selectedPriceRange}, sort=${sort}, page=${currentPage - 1})}"
     class="page-btn prev">‚Üê Tr∆∞·ªõc</a>

  <!-- D√≤ng hi·ªÉn th·ªã s·ªë trang -->
  <span class="page-info">
    Trang <span th:text="${currentPage}">1</span>/<span th:text="${totalPages}">1</span>
  </span>

  <!-- N√∫t Ti·∫øp -->
  <a th:if="${currentPage < totalPages}"
     th:href="@{'/shop'(category=${selectedCategory}, brand=${selectedBrand}, priceRange=${selectedPriceRange}, sort=${sort}, page=${currentPage + 1})}"
     class="page-btn next">Ti·∫øp ‚Üí</a>
</div>


<!-- =============== FOOTER =============== -->
<div th:replace="fragments/_footer :: footer"></div>

</body>
</html>
