<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{decorators/manager-layout}">
<head>
<title
	th:text="${voucher.voucherId == null ? 'Thêm Voucher' : 'Chỉnh sửa Voucher'}"></title>
<style>
.btn-rose {
	background: #DC92B3;
	color: #fff;
	border-radius: 8px;
}

.field-row {
	gap: 12px;
}

.small-muted {
	font-size: 0.85rem;
	color: #666;
}
</style>
</head>
<body>
	<section layout:fragment="content" class="px-4 mt-3">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<h4 class="fw-bold" style="color: #DC92B3;"
				th:text="${voucher.voucherId == null ? 'Thêm Voucher' : 'Chỉnh sửa Voucher'}"></h4>
			<a th:href="@{/manager/vouchers}" class="btn btn-outline-secondary">Quay
				lại</a>
		</div>

		<div class="card p-3">
			<form th:action="@{/manager/vouchers/save}" method="post"
				th:object="${voucher}">
				<input type="hidden" th:field="*{voucherId}" />
				<div class="row g-3">
					<!-- Mã và Tên -->
					<div class="col-md-4">
						<label class="form-label">Mã (code)</label> <input
							class="form-control" th:field="*{code}" required />
					</div>
					<div class="col-md-8">
						<label class="form-label">Tên</label> <input class="form-control"
							th:field="*{name}" required />
					</div>

					<!-- Loại (DiscountType) -->
					<div class="col-md-4">
						<label class="form-label">Loại</label> <select class="form-select"
							id="discountType" th:field="*{discountType}">
							<option th:each="dt : ${allTypes}" th:value="${dt}"
								th:text="${dt.label}"
								th:selected="${voucher.discountType == dt}"></option>
						</select>
					</div>

					<!-- % giảm -->
					<div class="col-md-2" id="percentBox">
						<label class="form-label">%</label> <input type="number" min="0"
							max="100" step="1" class="form-control"
							th:field="*{discountPercent}" />
					</div>

					<!-- Số tiền giảm -->
					<div class="col-md-3" id="amountBox">
						<label class="form-label">Giảm (₫)</label> <input type="number"
							min="0" step="1000" class="form-control"
							th:field="*{discountAmount}" />
					</div>

					<!-- Giảm tối đa -->
					<div class="col-md-3" id="maxBox">
						<label class="form-label">Giảm tối đa (₫)</label> <input
							type="number" class="form-control" th:field="*{maxDiscountValue}" />
					</div>

					<!-- Min order value -->
					<div class="col-md-3">
						<label class="form-label">Giá trị đơn tối thiểu (₫)</label> <input
							type="number" min="0" step="1000" class="form-control"
							th:field="*{minOrderValue}" />
					</div>

					<!-- Số lượt dùng -->
					<div class="col-md-3">
						<label class="form-label">Số lượt dùng</label> <input
							type="number" min="0" class="form-control"
							th:field="*{usageLimit}" />
					</div>

					<div class="col-md-3">
						<label class="form-label">Ngày bắt đầu</label> <input
							type="datetime-local" class="form-control"
							th:field="*{startDate}"
							th:value="${voucher.startDate != null} ? ${#temporals.format(voucher.startDate,'dd/MM/yyyy HH:mm')} : ''" />
					</div>

					<!-- Ngày kết thúc -->
					<div class="col-md-3">
						<label class="form-label">Ngày kết thúc</label> <input
							type="datetime-local" class="form-control" th:field="*{endDate}"
							th:value="${voucher.endDate != null} ? ${#temporals.format(voucher.endDate,'dd/MM/yyyy HH:mm')} : ''" />
					</div>

					<!-- Trạng thái -->
					<div class="col-md-3">
						<label class="form-label">Trạng thái</label> <select
							class="form-select" th:field="*{status}">
							<option th:each="s : ${allStatuses}" th:value="${s}"
								th:text="${s.label}" th:selected="${voucher.status == s}">
							</option>
						</select>
					</div>

					<!-- Mô tả -->
					<div class="col-md-12">
						<label class="form-label">Mô tả</label>
						<textarea class="form-control" rows="3" th:field="*{description}"></textarea>
					</div>

					<!-- Buttons -->
					<div class="col-md-12 d-flex justify-content-end">
						<button class="btn btn-rose me-2" type="submit">
							<i class="fa fa-save me-1"></i> Lưu
						</button>
						<a th:href="@{/manager/vouchers}"
							class="btn btn-outline-secondary">Hủy</a>
					</div>
				</div>
		</form>
	</div>
				<!-- Script ẩn/hiện -->
	<script>
		function updateFields() {
    			const t = document.getElementById('discountType').value;
    			document.getElementById('percentBox').style.display = t === 'PERCENT' ? 'block' : 'none';
    			document.getElementById('amountBox').style.display = t === 'AMOUNT' ? 'block' : 'none';
    			document.getElementById('maxBox').style.display = t === 'PERCENT' ? 'block' : 'none';
		}
		document.getElementById('discountType').addEventListener('change', updateFields);
		updateFields();
	</script>
	</section>
</body>
</html>
