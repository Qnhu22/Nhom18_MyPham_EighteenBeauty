<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title>Thông tin tài khoản | OneShop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" th:href="@{/css/header.css}">
<link rel="stylesheet" th:href="@{/css/footer.css}">

  <style>
    :root {
      --rose:#f3d5e2; --rose-dark:#e8b4d1;
      --cream:#fafaf2; --dark:#222; --white:#fff;
    }
    body { background: var(--cream); margin: 0; }
    .page { max-width:1100px; margin:120px auto 60px; padding:0 16px; }
    h2 { font-size:24px;text-align: center; margin-bottom:20px; color:#111; }

    .grid { display:grid; grid-template-columns:260px 1fr; gap:20px; }
    .side {
      background:#fff; border:1px solid #eee; border-radius:16px;
      padding:12px; position:sticky; top:100px; height:max-content;
      box-shadow:0 4px 12px rgba(0,0,0,.05);
    }
    .nav-item { display:block; padding:10px 14px; margin:6px 0;
      border-radius:12px; text-decoration:none; color:#222;
      border:1px solid #eee; background:#fff;
    }
    .nav-item:hover, .nav-item.active {
      background:var(--rose); border-color:var(--rose-dark);
    }

    .cards { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .card {
      background:#fff; border:1px solid #eee; border-radius:16px; padding:16px;
      box-shadow:0 4px 12px rgba(0,0,0,.05);
    }
    .card h5 { margin:0 0 12px; font-size:16px; }
    .profile { display:grid; grid-template-columns:120px 1fr; gap:16px; }
    .avatar { width:120px; height:120px; border-radius:50%; object-fit:cover;
              border:4px solid var(--rose-dark); }
    .kv { display:grid; grid-template-columns:140px 1fr; margin:6px 0; font-size:14px; }
    .muted { color:#666; }
    .chip { display:inline-block; background:var(--rose);
            border:1px solid var(--rose-dark); border-radius:999px;
            padding:3px 10px; font-size:12px; margin-right:5px; }
    .btn {
      width:100%; background:#111; color:#fff; border:none;
      border-radius:999px; padding:10px; cursor:pointer;
    }
    .btn:hover { filter:brightness(1.1); }
    @media(max-width:900px){.grid{grid-template-columns:1fr}.cards{grid-template-columns:1fr}.avatar{width:90px;height:90px}}
  </style>
</head>
<body>
<div th:replace="~{fragments/_header :: header}"></div>

<main class="page" sec:authorize="isAuthenticated()">
  <h2>Thông tin tài khoản</h2>

  <div class="grid">
    <!-- Sidebar -->
    <aside class="side">
      <a class="nav-item active" th:href="@{/account}">Thông tin tài khoản</a>
      <a class="nav-item" th:href="@{/account/orders}">Lịch sử đơn hàng</a>
      <a class="nav-item" th:href="@{/account/vouchers}">Ví Voucher</a>
      <a class="nav-item" th:href="@{/account/addresses}">Địa chỉ giao hàng</a>
      <a class="nav-item" th:href="@{/account/wishlist}">Danh sách yêu thích</a>

      <!-- Role-specific links (nếu cần sau này) -->
      <a class="nav-item" sec:authorize="hasRole('ADMIN')" th:href="@{/admin}">Quản trị</a>
      <a class="nav-item" sec:authorize="hasRole('SHIPPER')" th:href="@{/shipper/tasks}">Đơn cần giao</a>

      <form th:action="@{/logout}" method="post">
        <button class="nav-item" type="submit">Đăng xuất</button>
      </form>
    </aside>

    <!-- Main content -->
    <section class="content">
      <div class="cards">
        <!-- Thông tin cá nhân -->
        <div class="card">
          <h5>Thông tin cá nhân</h5>
          <div class="profile">
            <img class="avatar"
     th:src="${#strings.isEmpty(u.avatar)} ? @{/images/avatar/default-avatar.png} : ${u.avatar}"
     alt="Avatar">
            <div>
              <div class="kv"><div class="muted">Họ và tên</div><div th:text="${u.fullName}">—</div></div>
              <div class="kv"><div class="muted">Số điện thoại</div><div th:text="${u.phone}">—</div></div>
              <div class="kv"><div class="muted">Giới tính</div><div th:text="${u.gender}">—</div></div>
              <div class="kv"><div class="muted">Ngày sinh</div><div th:text="${u.birthDate}">—</div></div>
              <div class="kv"><div class="muted">Username</div><div th:text="${u.username}">—</div></div>
              <div class="kv"><div class="muted">Ngày tạo</div>
                   <div th:text="${#temporals.format(u.createAt,'dd/MM/yyyy')}">—</div></div>
            </div>
          </div>
          <button class="btn" style="margin-top:14px" onclick="openModal()">Cập nhật</button>

        </div>

        <!-- Thông tin đăng nhập -->
        <div class="card">
          <h5>Thông tin đăng nhập</h5>
          <div class="kv"><div class="muted">Email</div><div th:text="${u.email}">—</div></div>
          <div class="kv"><div class="muted">Mật khẩu</div><div th:text="${maskedPassword}">********</div></div>
          <div class="kv"><div class="muted">Vai trò</div>
            <div><span class="chip" th:each="r : ${roles}" th:text="${r}">ROLE_USER</span></div>
          </div>
          <div class="kv"><div class="muted">Lần đăng nhập gần nhất</div>
              <div th:text="${#temporals.format(u.lastLogin,'dd/MM/yyyy HH:mm')}">—</div></div>
          <button class="btn" style="margin-top:14px" onclick="openChangePassModal()">Cập nhật</button>

        </div>
      </div>
    </section>
  </div>
</main>

<!-- Guest -->
<main class="page" sec:authorize="isAnonymous()">
  <h2>Bạn cần đăng nhập để xem thông tin tài khoản</h2>
  <a th:href="@{/login}">→ Đăng nhập</a>
</main>
<!-- Gọi modal chỉnh sửa -->
<div th:replace="~{account/edit-profile :: editProfileModal}"></div>
<!-- Gọi modal đổi mật khẩu -->
<div th:replace="~{account/change-password :: changePassModal}"></div>
<div th:replace="~{fragments/_footer :: footer}"></div>
</body>
</html>
