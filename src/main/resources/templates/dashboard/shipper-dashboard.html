<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Shipper Dashboard | OneShop</title>

<!-- CSS -->
<link rel="stylesheet" th:href="@{/css/theme.css}" />
<link rel="stylesheet" th:href="@{/css/header.css}" />
<link rel="stylesheet" th:href="@{/css/banner.css}" />
<link rel="stylesheet" th:href="@{/css/footer.css}" />

<!-- Font Awesome -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
main.container {
	margin-top: 130px;
}

.dashboard-grid {
	display: flex;
	gap: 20px;
	justify-content: center;
	flex-wrap: wrap;
	margin-top: 20px;
}

.card {
	background: var(--color-white);
	border-radius: 8px;
	padding: 20px;
	flex: 1 1 250px;
	box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
	text-align: center;
	transition: 0.3s;
}

.card h4 {
	margin-bottom: 10px;
	color: var(--color-dark);
}

.card p {
	font-size: 16px;
	margin-bottom: 15px;
	font-weight: 500;
}

.card .btn {
	display: inline-block;
	padding: 10px 20px;
	background: var(--color-rose);
	color: var(--color-white);
	border-radius: 25px;
	text-decoration: none;
	transition: 0.3s;
}

.card .btn:hover {
	background: #e60073;
	transform: scale(1.05);
}

/* --- Th·ªëng k√™ m·ªü r·ªông --- */
.stats-section {
	margin-top: 50px;
	text-align: center;
}

.stats-section h3 {
	color: var(--color-dark);
	margin-bottom: 20px;
}

.charts-container {
	display: flex;
	justify-content: center;
	gap: 50px;
	flex-wrap: wrap;
}

.chart-box {
	width: 400px;
	background: #fff;
	border-radius: 12px;
	padding: 20px;
	box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.total-amount {
	margin-top: 30px;
	font-size: 18px;
	font-weight: 600;
	color: var(--color-dark);
}

.export-btn {
	margin-top: 20px;
	background: var(--color-rose);
	color: #fff;
	border: none;
	padding: 10px 25px;
	border-radius: 25px;
	cursor: pointer;
	font-weight: 500;
	transition: 0.3s;
}

.export-btn:hover {
	background: #e60073;
}
</style>
</head>
<body>
	<header th:replace="fragments/_header :: header"></header>

	<main class="container">
		<h2 class="text-center mb-4">
			Xin ch√†o, <span th:text="${shipperName}">Shipper</span>!
		</h2>


		<!-- Cards hi·ªán c√≥ -->
		<div class="dashboard-grid">

			<div class="card">
				<h4>T·∫•t c·∫£ ƒë∆°n h√†ng</h4>
				<p th:text="|${totalOrders} ƒë∆°n|">0 ƒë∆°n</p>
				<a th:href="@{/shipper/orders}" class="btn">Xem t·∫•t c·∫£</a>
			</div>


			<div class="card">
				<h4>ƒê∆°n ƒëang giao</h4>
				<p th:text="|${shippingCount} ƒë∆°n|">0 ƒë∆°n</p>
				<a th:href="@{/shipper/orders(status='SHIPPING')}" class="btn">Xem
					chi ti·∫øt</a>
			</div>

			<div class="card">
				<h4>ƒê√£ giao th√†nh c√¥ng</h4>
				<p th:text="|${deliveredCount} ƒë∆°n|">0 ƒë∆°n</p>
				<a th:href="@{/shipper/orders(status='DELIVERED')}" class="btn">Xem
					chi ti·∫øt</a>
			</div>

			<div class="card">
				<h4>ƒê∆°n giao th·∫•t b·∫°i</h4>
				<p th:text="|${cancelledCount} ƒë∆°n|">0 ƒë∆°n</p>
				<a th:href="@{/shipper/orders(status='CANCELLED')}" class="btn">Xem
					chi ti·∫øt</a>
			</div>

			<div class="card">
				<h4>ƒê∆°n c·∫ßn giao</h4>
				<p th:text="|${confirmedCount} ƒë∆°n|">0 ƒë∆°n</p>
				<a th:href="@{/shipper/orders(status='CONFIRMED')}" class="btn">Xem
					chi ti·∫øt</a>
			</div>

			<div class="card">
				<h4>ƒê∆°n ƒë∆∞·ª£c tr·∫£ v·ªÅ</h4>
				<p th:text="|${returnedCount} ƒë∆°n|">0 ƒë∆°n</p>
				<a th:href="@{/shipper/orders(status='RETURNED')}" class="btn">Xem
					chi ti·∫øt</a>
			</div>


		</div>

		<!-- Th·ªëng k√™ m·ªü r·ªông -->
		<section class="stats-section">
			<h3>Th·ªëng k√™ hi·ªáu su·∫•t giao h√†ng</h3>
			<div class="charts-container">
				<div class="chart-box">
					<canvas id="orderStatusChart"></canvas>
				</div>

				<div class="chart-box">
					<canvas id="revenueChart"></canvas>
				</div>
			</div>

			<div class="total-amount">
				üí∞ T·ªïng gi√° tr·ªã h√†ng ƒë√£ giao th√†nh c√¥ng: <span
					th:text="|${#numbers.formatDecimal(totalRevenue, 0, 'COMMA', 0, 'POINT')}ƒë|">0ƒë</span>
			</div>

			<form th:action="@{/shipper/statistics/export}" method="get">
				<button type="submit" class="export-btn">
					<i class="fa-solid fa-file-export"></i> Xu·∫•t b√°o c√°o doanh thu
				</button>
			</form>
		</section>
	</main>

	<footer th:replace="fragments/_footer :: footer"></footer>
<script th:inline="javascript">
/*<![CDATA[*/
    // an to√†n: Thymeleaf s·∫Ω thay /*[[...]]*/ b·∫±ng gi√° tr·ªã (s·ªë) ho·∫∑c ƒë·ªÉ nguy√™n 0 n·∫øu null
    var shippingCount = /*[[${shippingCount} != null ? shippingCount : 0]]*/ 0;
    var deliveredCount = /*[[${deliveredCount} != null ? deliveredCount : 0]]*/ 0;
    var cancelledCount = /*[[${cancelledCount} != null ? cancelledCount : 0]]*/ 0;
    var returnedCount = /*[[${returnedCount} != null ? returnedCount : 0]]*/ 0;
    var confirmedCount = /*[[${confirmedCount} != null ? confirmedCount : 0]]*/ 0;

    // ki·ªÉm tra nhanh (b·ªè comment khi ch·∫°y ·ªïn)
    // console.log(shippingCount, deliveredCount, cancelledCount, returnedCount, confirmedCount);

    const statusData = {
        labels: ['ƒêang giao', 'ƒê√£ giao', 'B·ªã h·ªßy', 'Tr·∫£ v·ªÅ', 'C·∫ßn giao'],
        datasets: [{
            data: [shippingCount, deliveredCount, cancelledCount, returnedCount, confirmedCount],
            backgroundColor: ['#36A2EB', '#4CAF50', '#FF6384', '#FFCE56', '#FF9800']
        }]
    };

    new Chart(document.getElementById('orderStatusChart'), {
        type: 'doughnut',
        data: statusData,
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
/*]]>*/
</script>




</body>
</html>
